<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Portal KARTEJI ‚Ä¢ Cilosari Barat</title>
<link rel="icon" href="assets/logo.svg" />

<style>
/* === WARNA ADAPTIF (TERANG/GELAP) === */
:root {
  --glass-bg: rgba(255,255,255,0.65);
  --text: #111;
  --muted: #444;
  --accent: #0e4c92;
  --highlight: #f6c445;
  --line: rgba(0,0,0,0.08);
  --shadow: 0 8px 32px rgba(0,0,0,.15);
}
@media (prefers-color-scheme: dark) {
  :root {
    --glass-bg: rgba(25,25,30,0.55);
    --text: #f1f5f9;
    --muted: #94a3b8;
    --accent: #1a73e8;
    --highlight: #ffd966;
    --line: rgba(255,255,255,0.12);
    --shadow: 0 8px 40px rgba(0,0,0,.4);
  }
}

*{box-sizing:border-box;transition:.3s ease all}
body{
  margin:0;font-family:'Poppins',system-ui,Arial;
  background:url('assets/bg/blur-home.jpg') center/cover no-repeat fixed;
  color:var(--text);
  display:flex;min-height:100vh;
}

/* === SIDEBAR === */
aside{
  width:240px;
  backdrop-filter:blur(24px);
  background:var(--glass-bg);
  border-right:1px solid var(--line);
  padding:1rem;
  display:flex;flex-direction:column;
  justify-content:space-between;
  box-shadow:var(--shadow);
}
aside .logo{
  display:flex;align-items:center;gap:.7rem;
  font-weight:700;font-size:1.1rem;margin-bottom:2rem;
}
aside .logo img{width:38px;height:38px;border-radius:8px;}
aside nav a{
  display:block;padding:.7rem 1rem;margin-bottom:.4rem;
  border-radius:10px;text-decoration:none;
  color:var(--text);font-weight:600;
}
aside nav a:hover{background:rgba(0,0,0,0.08)}
@media(prefers-color-scheme:dark){
  aside nav a:hover{background:rgba(255,255,255,0.1);}
}

/* === HEADER TOP === */
header{
  position:sticky;top:0;z-index:10;
  backdrop-filter:blur(18px);
  background:var(--glass-bg);
  border-bottom:1px solid var(--line);
  display:flex;justify-content:space-between;align-items:center;
  padding:.8rem 1.2rem;margin-bottom:1rem;
  border-radius:16px;
}
.profile{
  display:flex;align-items:center;gap:.6rem;
}
.profile img{
  width:42px;height:42px;border-radius:50%;object-fit:cover;
  border:2px solid rgba(0,0,0,.15);cursor:pointer;
}

/* === MAIN === */
main{
  flex:1;padding:2rem;
  display:flex;flex-direction:column;gap:2rem;
  backdrop-filter:blur(24px);
}
.section{
  background:var(--glass-bg);
  border:1px solid var(--line);
  border-radius:20px;
  padding:1.5rem;
  box-shadow:var(--shadow);
}
.section h2{
  margin-top:0;margin-bottom:1rem;
  font-size:1.2rem;color:var(--accent);
  border-left:4px solid var(--highlight);
  padding-left:.5rem;
}

/* === UMKM HORIZONTAL === */
.umkm-scroll{
  display:flex;overflow-x:auto;gap:1rem;
  scroll-snap-type:x mandatory;padding-bottom:1rem;
}
.umkm-card{
  flex:0 0 180px;scroll-snap-align:start;
  background:var(--glass-bg);
  border:1px solid var(--line);
  border-radius:14px;
  box-shadow:var(--shadow);
  padding:.8rem;
  text-align:center;cursor:pointer;
}
.umkm-card img{
  width:100%;height:140px;object-fit:cover;
  border-radius:10px;margin-bottom:.4rem;
}
.umkm-card b{font-size:.95rem;display:block;}
.umkm-card span{color:var(--highlight);font-weight:600;font-size:.9rem;}

/* === BERITA CARD === */
.berita-grid{display:grid;gap:1.2rem;}
@media(min-width:700px){.berita-grid{grid-template-columns:repeat(3,1fr)}}
.berita-card{
  background:var(--glass-bg);border:1px solid var(--line);
  border-radius:14px;box-shadow:var(--shadow);
  overflow:hidden;cursor:pointer;
}
.berita-card img{width:100%;height:150px;object-fit:cover;}
.berita-card .isi{padding:.8rem;}
.berita-card b{display:block;font-size:1rem;margin-bottom:.4rem;}
.berita-card p{color:var(--muted);font-size:.9rem;}

/* === FOOTER === */
footer{
  text-align:center;padding:2rem 1rem;
  color:var(--muted);font-size:.9rem;
}
.hidden{display:none;}
</style>
</head>

<body>
<!-- === SIDEBAR === -->
<aside>
  <div>
    <div class="logo"><img src="assets/logo.svg"><span>KARTEJI</span></div>
    <nav>
      <a href="#kegiatan">üí™ Kegiatan</a>
      <a href="#berita">üì∞ Berita</a>
      <a href="#umkm">üè™ UMKM</a>
      <a href="#pengumuman">üì¢ Pengumuman</a>
    </nav>
  </div>
  <div>
    <a href="auth.html" id="loginBtn" class="btn-outline">üîê Masuk / Daftar</a>
    <a href="dashboard.html" id="dashBtn" class="btn-outline hidden">üìä Dashboard</a>
    <button id="logoutBtn" class="btn-outline hidden" style="width:100%">Keluar</button>
  </div>
</aside>

<!-- === KONTEN === -->
<main>
  <header>
    <h1>Portal Digital Cilosari Barat</h1>
    <div class="profile">
      <span id="userName" class="hidden"></span>
      <span id="poinUser" class="hidden">üèÖ 0 pts</span>
      <img id="userPhoto" class="hidden" src="assets/default-avatar.png">
    </div>
  </header>

  <section id="umkm" class="section">
    <h2>üè™ Produk UMKM</h2>
    <div id="umkmList" class="umkm-scroll"></div>
  </section>

  <section id="berita" class="section">
    <h2>üì∞ Berita Terbaru</h2>
    <div id="beritaList" class="berita-grid"></div>
  </section>

  <section id="pengumuman" class="section">
    <h2>üì¢ Pengumuman</h2>
    <div id="pengumumanList"></div>
  </section>

  <footer>¬© 2025 KARTEJI Cilosari Barat ¬∑ Dibuat dengan üíô Semarang</footer>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
import { getAuth,onAuthStateChanged,signOut } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
import { getFirestore,collection,getDocs,query,orderBy,doc,getDoc } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

const firebaseConfig={apiKey:"AIzaSyCgJC8OQBG_wQt57tZHfNuVKPb2VVlAalI",authDomain:"karang-taruna-aadaf.firebaseapp.com",projectId:"karang-taruna-aadaf",storageBucket:"karang-taruna-aadaf.appspot.com",messagingSenderId:"367208001887",appId:"1:367208001887:web:bce5982d99edefb7e746ea"};
const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

const loginBtn=document.getElementById('loginBtn');
const dashBtn=document.getElementById('dashBtn');
const logoutBtn=document.getElementById('logoutBtn');
const userName=document.getElementById('userName');
const poinUser=document.getElementById('poinUser');
const userPhoto=document.getElementById('userPhoto');

/* === FIRESTORE LOAD === */
async function loadUmkm(){
  const snap=await getDocs(query(collection(db,'umkm'),orderBy('createdAt','desc')));
  const c=document.getElementById('umkmList');
  c.innerHTML='';
  if(snap.empty){c.innerHTML='<p>Tidak ada produk.</p>';return;}
  snap.forEach(d=>{
    const u=d.data(), id=d.id;
    const foto=Array.isArray(u.foto)?u.foto[0]:u.foto;
    const el=document.createElement('div');
    el.className='umkm-card';
    el.innerHTML=`${foto?`<img src="${foto}">`:''}<b>${u.produk||'Tanpa nama'}</b><span>Rp ${(u.harga||0).toLocaleString('id-ID')}</span>`;
    el.onclick=()=>location.href=`umkm.html?id=${id}`;
    c.appendChild(el);
  });
}

async function loadBerita(){
  const snap=await getDocs(query(collection(db,'berita'),orderBy('createdAt','desc')));
  const c=document.getElementById('beritaList');
  c.innerHTML='';
  if(snap.empty){c.innerHTML='<p>Belum ada berita.</p>';return;}
  snap.forEach(d=>{
    const b=d.data(),id=d.id;
    const f=Array.isArray(b.foto)?b.foto[0]:b.foto;
    const el=document.createElement('div');
    el.className='berita-card';
    el.innerHTML=`<a href="berita.html?id=${id}">${f?`<img src="${f}" alt="">`:''}<div class="isi"><b>${b.judul||'Tanpa judul'}</b><p>${(b.isi||'').slice(0,120)}${b.isi&&b.isi.length>120?'‚Ä¶':''}</p></div></a>`;
    c.appendChild(el);
  });
}

async function loadPengumuman(){
  const snap=await getDocs(query(collection(db,'pengumuman'),orderBy('createdAt','desc')));
  const c=document.getElementById('pengumumanList');
  c.innerHTML='';
  snap.forEach(d=>{
    const p=d.data();
    const el=document.createElement('div');
    el.className='berita-card';
    el.innerHTML=`<div class="isi"><b>${p.judul||'Tanpa judul'}</b><p>${p.isi||''}</p></div>`;
    c.appendChild(el);
  });
}

/* === AUTH === */
onAuthStateChanged(auth, async (user)=>{
  if(user){
    const name=user.displayName||user.email;
    userName.textContent=name;
    userName.classList.remove('hidden');
    loginBtn.classList.add('hidden');
    logoutBtn.classList.remove('hidden');
    dashBtn.classList.remove('hidden');
    userPhoto.classList.remove('hidden');

    const snap=await getDoc(doc(db,'users',user.uid));
    if(snap.exists()){
      const data=snap.data();
      poinUser.textContent=`üèÖ ${data.poin||0} pts`;
      poinUser.classList.remove('hidden');
      if(data.foto) userPhoto.src=data.foto;
    }
  }else{
    userName.classList.add('hidden');
    poinUser.classList.add('hidden');
    userPhoto.classList.add('hidden');
    loginBtn.classList.remove('hidden');
    logoutBtn.classList.add('hidden');
    dashBtn.classList.add('hidden');
  }
  loadUmkm();loadBerita();loadPengumuman();
});
logoutBtn.onclick=()=>signOut(auth).then(()=>location.reload());
</script>
</body>
</html>
