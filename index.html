<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>KARTEJI Portal ‚Ä¢ Cilosari Barat</title>
<link rel="icon" href="assets/logo.svg" />
<style>
:root{
  --primary:#0e4c92;
  --accent:#f6c445;
  --text:#f5f5f7;
  --muted:#c9c9c9;
  --card:rgba(255,255,255,0.08);
  --line:rgba(255,255,255,0.15);
  --blur:20px;
  --shadow:0 8px 40px rgba(0,0,0,0.3);
}
*{box-sizing:border-box;transition:.3s ease all}
body{
  margin:0;font-family:'Poppins',system-ui,Arial;
  color:var(--text);
  background-size:cover;background-position:center;
  backdrop-filter:blur(12px);
  min-height:100vh;
}
a{text-decoration:none;color:inherit}

/* === HEADER === */
header{
  position:sticky;top:0;z-index:40;
  display:flex;align-items:center;justify-content:space-between;
  padding:1rem 1.5rem;
  background:rgba(255,255,255,0.05);
  backdrop-filter:blur(var(--blur));
  border-bottom:1px solid var(--line);
  box-shadow:var(--shadow);
}
.brand{display:flex;align-items:center;gap:.6rem;font-weight:700;font-size:1.1rem}
.brand img{width:40px;height:40px;border-radius:10px}
nav{display:flex;align-items:center;gap:1rem;flex-wrap:wrap}
.btn{
  padding:.6rem 1rem;border-radius:12px;font-weight:600;cursor:pointer;
  border:none;backdrop-filter:blur(10px);
}
.btn-primary{background:var(--accent);color:#0b132b;}
.btn-outline{background:transparent;border:1px solid var(--accent);color:var(--accent);}
.btn-outline:hover{background:var(--accent);color:#0b132b}
#themeBtn{background:transparent;border:none;color:var(--text);cursor:pointer}
.profile-pic{
  width:42px;height:42px;border-radius:50%;
  object-fit:cover;border:2px solid rgba(255,255,255,0.6);
  cursor:pointer;transition:.3s;
}
.profile-pic:hover{transform:scale(1.05);}

/* === HERO === */
.hero{
  text-align:center;
  max-width:760px;margin:5rem auto 3rem;
  background:var(--card);
  border:1px solid var(--line);
  border-radius:24px;
  padding:2.5rem 1.5rem;
  box-shadow:var(--shadow);
  backdrop-filter:blur(var(--blur));
  animation:fadeIn 1.2s ease forwards;
}
.hero h1{
  font-size:2.4rem;
  background:linear-gradient(90deg,var(--accent),#ffe89b);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  margin-bottom:.6rem;
}
.hero p{color:var(--muted);line-height:1.6;margin-bottom:2rem;}
.hero .btn-primary{font-size:1.05rem;padding:.8rem 1.8rem;border-radius:14px;}

/* === SECTION === */
.section{max-width:1100px;margin:auto;padding:2rem 1rem;}
.section h2{text-align:center;color:var(--accent);margin-bottom:1.4rem;}

/* === UMKM HORIZONTAL === */
.umkm-scroll{
  display:flex;overflow-x:auto;gap:1rem;
  scroll-snap-type:x mandatory;padding-bottom:1rem;
}
.umkm-card{
  flex:0 0 200px;scroll-snap-align:start;
  background:var(--card);
  border:1px solid var(--line);
  border-radius:16px;box-shadow:var(--shadow);
  text-align:center;padding:1rem;
  cursor:pointer;
  backdrop-filter:blur(var(--blur));
  transform:translateY(0);
}
.umkm-card:hover{transform:translateY(-5px);}
.umkm-card img{width:100%;height:150px;object-fit:cover;border-radius:12px;margin-bottom:.6rem;}
.umkm-card b{display:block;font-size:.95rem;margin-bottom:.3rem;}
.umkm-card span{color:var(--accent);font-weight:600;font-size:.9rem;}

/* === BERITA GRID === */
.berita-grid{display:grid;gap:1.2rem;}
@media(min-width:700px){.berita-grid{grid-template-columns:repeat(3,1fr)}}
.berita-card{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:18px;
  box-shadow:var(--shadow);
  overflow:hidden;
  backdrop-filter:blur(var(--blur));
  cursor:pointer;
  animation:fadeInUp .8s ease both;
}
.berita-card img{width:100%;height:160px;object-fit:cover;}
.berita-card .isi{padding:1rem;}
.berita-card b{font-size:1.05rem;color:#fff;margin-bottom:.4rem;display:block;}
.berita-card p{color:var(--muted);font-size:.9rem;}

/* === FOOTER === */
footer{text-align:center;padding:2rem 1rem;color:var(--muted);margin-top:3rem;backdrop-filter:blur(var(--blur));}

/* === ANIMASI === */
@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeInUp{from{opacity:0;transform:translateY(40px)}to{opacity:1;transform:translateY(0)}}
.hidden{display:none;}
</style>
</head>
<body>
<header>
  <div class="brand">
    <img src="assets/logo.svg" alt="Logo">
    <span>KARTEJI Portal</span>
  </div>
  <nav>
    <a href="#kegiatan">Kegiatan</a>
    <a href="#berita">Berita</a>
    <a href="#umkm">UMKM</a>
    <a href="#pengumuman">Pengumuman</a>
    <button id="themeBtn">üåì</button>
    <span id="userName" class="hidden"></span>
    <span id="poinUser" class="poinBox hidden">üèÖ 0 pts</span>
    <img id="userPhoto" class="profile-pic hidden" src="assets/default-avatar.png" alt="Profil">
    <a id="loginBtn" href="auth.html" class="btn btn-primary">Masuk / Daftar</a>
    <a id="dashBtn" href="dashboard.html" class="btn btn-outline hidden">Dashboard</a>
    <button id="logoutBtn" class="btn btn-outline hidden">Keluar</button>
  </nav>
</header>

<section class="hero">
  <h1>Portal Digital Karang Taruna<br>Cilosari Barat RT01/RW08</h1>
  <p>üí™ Pelatihan, lomba, kegiatan sosial<br>üí∞ Informasi kas dan iuran<br>üß† Konten edukatif<br>üèÖ Poin & lencana keaktifan</p>
  <a href="auth.html" class="btn btn-primary" id="ctaBtn">üöÄ Mulai Sekarang</a>
</section>

<section id="umkm" class="section">
  <h2>üè™ Produk UMKM</h2>
  <div id="umkmList" class="umkm-scroll"></div>
</section>

<section id="berita" class="section">
  <h2>üì∞ Berita Terbaru</h2>
  <div id="beritaList" class="berita-grid"></div>
</section>

<section id="pengumuman" class="section">
  <h2>üì¢ Pengumuman</h2>
  <div id="pengumumanList"></div>
</section>

<footer><p>¬© 2025 KARTEJI Cilosari Barat ¬∑ Dibuat dengan üíô di Semarang</p></footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
import { getAuth,onAuthStateChanged,signOut } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
import { getFirestore,collection,getDocs,query,orderBy,doc,getDoc } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

const firebaseConfig={apiKey:"AIzaSyCgJC8OQBG_wQt57tZHfNuVKPb2VVlAalI",authDomain:"karang-taruna-aadaf.firebaseapp.com",projectId:"karang-taruna-aadaf",storageBucket:"karang-taruna-aadaf.appspot.com",messagingSenderId:"367208001887",appId:"1:367208001887:web:bce5982d99edefb7e746ea"};
const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

const themeBtn=document.getElementById('themeBtn');
const loginBtn=document.getElementById('loginBtn');
const dashBtn=document.getElementById('dashBtn');
const logoutBtn=document.getElementById('logoutBtn');
const ctaBtn=document.getElementById('ctaBtn');
const userName=document.getElementById('userName');
const poinUser=document.getElementById('poinUser');
const userPhoto=document.getElementById('userPhoto');

themeBtn.onclick=()=>document.body.classList.toggle('light');

/* === BACKGROUND FIRESTORE (hanya super admin ubah) === */
async function loadBackground(){
  try{
    const snap=await getDoc(doc(db,"settings","background"));
    if(snap.exists()){
      const data=snap.data();
      if(data.url) document.body.style.backgroundImage=`url('${data.url}')`;
    }else{
      document.body.style.background=`linear-gradient(120deg,#bcbfc4,#d4d7da)`;
    }
  }catch(e){console.warn("BG error:",e);}
}

/* === LOAD DATA === */
async function loadUmkm(){
  const snap=await getDocs(query(collection(db,'umkm'),orderBy('createdAt','desc')));
  const c=document.getElementById('umkmList');
  c.innerHTML='';
  if(snap.empty){c.innerHTML='<p class="muted">Belum ada produk.</p>';return;}
  snap.forEach(d=>{
    const u=d.data(), id=d.id;
    const foto=Array.isArray(u.foto)?u.foto[0]:u.foto;
    const el=document.createElement('div');
    el.className='umkm-card';
    el.innerHTML=`${foto?`<img src="${foto}">`:''}<b>${u.produk||'(Tanpa nama)'}</b><span>Rp ${(u.harga||0).toLocaleString('id-ID')}</span>`;
    el.onclick=()=>location.href=`umkm.html?id=${id}`;
    c.appendChild(el);
  });
}

async function loadBerita(){
  const snap=await getDocs(query(collection(db,'berita'),orderBy('createdAt','desc')));
  const c=document.getElementById('beritaList');
  c.innerHTML='';
  if(snap.empty){c.innerHTML='<p class="muted">Belum ada berita.</p>';return;}
  snap.forEach(d=>{
    const b=d.data(),id=d.id;
    const f=Array.isArray(b.foto)?b.foto[0]:b.foto;
    const el=document.createElement('div');
    el.className='berita-card';
    el.innerHTML=`<a href="berita.html?id=${id}">${f?`<img src="${f}" alt="">`:''}<div class="isi"><b>${b.judul||'(Tanpa judul)'}</b><p>${(b.isi||'').slice(0,120)}${b.isi&&b.isi.length>120?'‚Ä¶':''}</p></div></a>`;
    c.appendChild(el);
  });
}

async function loadPengumuman(){
  const snap=await getDocs(query(collection(db,'pengumuman'),orderBy('createdAt','desc')));
  const c=document.getElementById('pengumumanList');c.innerHTML='';
  if(snap.empty){c.innerHTML='<p class="muted">Belum ada pengumuman.</p>';return;}
  snap.forEach(d=>{
    const p=d.data();
    const el=document.createElement('div');
    el.className='berita-card';
    el.innerHTML=`<div class="isi"><b>${p.judul||'(Tanpa judul)'}</b><p>${p.isi||''}</p></div>`;
    c.appendChild(el);
  });
}

/* === AUTH STATE === */
onAuthStateChanged(auth, async (user)=>{
  if(user){
    const name=user.displayName||user.email;
    userName.textContent=`üëã ${name}`;
    userName.classList.remove('hidden');
    poinUser.classList.remove('hidden');
    loginBtn.classList.add('hidden');
    logoutBtn.classList.remove('hidden');
    dashBtn.classList.remove('hidden');
    userPhoto.classList.remove('hidden');
    ctaBtn.textContent="üè† Buka Dashboard";
    ctaBtn.href="dashboard.html";

    const snap=await getDoc(doc(db,'users',user.uid));
    if(snap.exists()){
      const data=snap.data();
      poinUser.textContent=`üèÖ ${data.poin||0} pts`;
      userPhoto.src=data.foto||"assets/default-avatar.png";
    }
  }else{
    userName.classList.add('hidden');
    poinUser.classList.add('hidden');
    loginBtn.classList.remove('hidden');
    logoutBtn.classList.add('hidden');
    dashBtn.classList.add('hidden');
    userPhoto.classList.add('hidden');
    ctaBtn.textContent="üöÄ Mulai Sekarang";
    ctaBtn.href="auth.html";
  }
  await loadBackground();
  loadUmkm();loadBerita();loadPengumuman();
});

logoutBtn.onclick=()=>signOut(auth).then(()=>location.reload());
</script>
</body>
</html>
