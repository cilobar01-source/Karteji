<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dashboard • KARTEJI v4.3</title>
<link rel="icon" href="assets/logo.svg" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --biru:#0e4c92; --biru2:#1a6ac2; --emas:#f6c445;
  --bg:#0b132b; --text:#e6eefc; --card:#111928; --line:rgba(255,255,255,.12);
  --muted:#b8c7e0; --danger:#d94646; --success:#14b86a;
}
body.light{
  --bg:#f5f7fa; --text:#1e293b; --card:#fff; --line:rgba(0,0,0,.1);
  --muted:#475569;
}
*{box-sizing:border-box}
body{margin:0;font-family:'Poppins',system-ui;background:var(--bg);color:var(--text);transition:background .3s,color .3s;}

/* Topbar */
.topbar{display:flex;align-items:center;justify-content:space-between;
  background:linear-gradient(90deg,var(--biru),var(--biru2));color:#fff;padding:.7rem 1rem;position:sticky;top:0;z-index:20;}
.topbar .left{display:flex;align-items:center;gap:.6rem;font-weight:700;}
.topbar .right{display:flex;gap:.5rem;align-items:center;flex-wrap:wrap;}
.btn{border:none;border-radius:10px;padding:.55rem .9rem;font-weight:700;cursor:pointer}
.btn-ghost{background:transparent;border:1px solid var(--line);color:inherit}
.btn-primary{background:var(--emas);color:#0b132b}
.btn-danger{background:var(--danger);color:#fff}
.badge{display:inline-block;background:var(--biru2);color:#fff;padding:.15rem .5rem;border-radius:6px;font-size:.8rem;font-weight:800}

/* Layout */
.wrap{display:grid;grid-template-columns:270px 1fr;gap:1rem;padding:1rem;}
@media(max-width:960px){.wrap{grid-template-columns:1fr}}
.card{background:var(--card);border:1px solid var(--line);border-radius:12px;overflow:hidden}
.pad{padding:1rem}
.hidden{display:none}

/* Sidebar dropdown */
.sidebar{position:sticky;top:70px;height:max-content}
.menu-group{border:1px solid var(--line);border-radius:12px;overflow:hidden;margin-bottom:.8rem;background:var(--card);}
.menu-head{display:flex;align-items:center;justify-content:space-between;padding:.8rem 1rem;cursor:pointer;font-weight:700;}
.menu-head:hover{background:rgba(255,255,255,.05)}
.menu-list{max-height:0;overflow:hidden;transition:max-height .3s ease;}
.menu-list.show{max-height:600px;}
.menu-list button{display:block;width:100%;background:transparent;border:1px solid var(--line);
  color:inherit;border-radius:10px;padding:.55rem .8rem;margin:.35rem 0;text-align:left;cursor:pointer;transition:.2s;}
.menu-list button.active{background:var(--emas);color:#0b132b;border-color:var(--emas);font-weight:800;}
.menu-arrow{transition:transform .3s;}
.rotate{transform:rotate(90deg)}

/* Responsive bottom tabs */
.bottom-tabs{display:none}
@media(max-width:960px){
  .sidebar{display:none}
  .bottom-tabs{position:fixed;left:0;right:0;bottom:0;background:var(--card);border-top:1px solid var(--line);
    display:grid;grid-template-columns:repeat(5,1fr);z-index:25}
  .bottom-tabs button{background:transparent;border:none;color:inherit;padding:.7rem 0;font-size:1rem;}
  .bottom-tabs button.active{color:var(--emas);}
}

/* Utilities */
.toast{position:fixed;bottom:20px;right:20px;background:var(--card);border:1px solid var(--emas);
  padding:.6rem .9rem;border-radius:10px;z-index:9999;}
.muted{color:var(--muted);font-size:.9rem;}
.table-like .item{display:grid;grid-template-columns:1fr auto;gap:.6rem;border:1px dashed var(--line);border-radius:10px;padding:.7rem;margin:.4rem 0}
.table-like .right .btn{margin-left:.3rem}
</style>
</head>

<body>
<!-- TOPBAR -->
<div class="topbar">
  <div class="left">
    <img src="assets/logo.svg" alt="logo" style="width:34px;height:34px;border-radius:8px;">
    <span>Dashboard KARTEJI</span>
  </div>
  <div class="right">
    <span id="userInfo">Memuat...</span>
    <button id="themeBtn" class="btn btn-ghost">🌓</button>
    <a class="btn btn-ghost" href="index.html">↩️ Beranda</a>
    <button id="logoutBtn" class="btn btn-ghost">Keluar</button>
  </div>
</div>

<div class="wrap">
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="menu-group">
      <div class="menu-head" id="headMaster">
        <span>📋 Data Master</span><span id="arrowMaster" class="menu-arrow">▶</span>
      </div>
      <div id="listMaster" class="menu-list">
        <button data-panel="home" class="active">🏠 Ringkasan</button>
        <button data-panel="pengumuman">📢 Pengumuman</button>
        <button data-panel="berita">📰 Berita</button>
        <button data-panel="umkm">🏪 UMKM</button>
        <button data-panel="kas">💰 Kas</button>
        <button data-panel="anggota">👥 Anggota</button>
      </div>
    </div>

    <div class="menu-group">
      <div class="menu-head" id="headSettings">
        <span>⚙️ Pengaturan</span><span id="arrowSettings" class="menu-arrow">▶</span>
      </div>
      <div id="listSettings" class="menu-list">
        <button data-panel="profil">👤 Profil Saya</button>
      </div>
    </div>
  </aside>

  <main id="main">
    <!-- Contoh isi panel -->
    <section id="panel-home" class="card pad">
      <h3>🏠 Ringkasan</h3>
      <canvas id="kasChart" height="160"></canvas>
      <hr class="sep"/>
      <p class="muted">Total kas dan data akan dimuat otomatis dari Firestore.</p>
    </section>

    <section id="panel-profil" class="card pad hidden">
      <h3>👤 Profil Saya</h3>
      <input id="prNama" placeholder="Nama Lengkap">
      <input id="prFoto" type="file" accept="image/*">
      <button id="prSimpan" class="btn btn-primary">Simpan Profil</button>
      <p class="muted">Email: <span id="prEmail">-</span> · Role: <span class="badge" id="prRole">-</span></p>
    </section>
  </main>
</div>

<!-- Bottom nav (mobile) -->
<div class="bottom-tabs">
  <button data-panel="home">🏠</button>
  <button data-panel="pengumuman">📢</button>
  <button data-panel="berita">📰</button>
  <button data-panel="umkm">🏪</button>
  <button data-panel="kas">💰</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
import { getFirestore, getDoc, doc } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCgJC8OQBG_wQt57tZHfNuVKPb2VVlAalI",
  authDomain: "karang-taruna-aadaf.firebaseapp.com",
  projectId: "karang-taruna-aadaf",
  storageBucket: "karang-taruna-aadaf.appspot.com",
  messagingSenderId: "367208001887",
  appId: "1:367208001887:web:bce5982d99edefb7e746ea"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db   = getFirestore(app);

const $ = s=>document.querySelector(s);
const $$= s=>document.querySelectorAll(s);
const toast = m=>{const d=document.createElement('div');d.className='toast';d.textContent=m;document.body.appendChild(d);setTimeout(()=>d.remove(),2500);};

// Tema toggle
$("#themeBtn").onclick=()=>document.body.classList.toggle('light');

// Sidebar dropdown
function toggleList(head,list,arrow){
  list.classList.toggle('show');
  arrow.classList.toggle('rotate');
}
$("#headMaster").onclick=()=>toggleList($("#headMaster"),$("#listMaster"),$("#arrowMaster"));
$("#headSettings").onclick=()=>toggleList($("#headSettings"),$("#listSettings"),$("#arrowSettings"));
$("#listMaster").classList.add('show');
$("#arrowMaster").classList.add('rotate');

// Navigasi panel
$$('[data-panel]').forEach(b=>{
  b.onclick=()=>{
    $$('main > section').forEach(s=>s.classList.add('hidden'));
    $('#panel-'+b.dataset.panel)?.classList.remove('hidden');
    $$('#listMaster button').forEach(x=>x.classList.toggle('active',x.dataset.panel===b.dataset.panel));
  };
});

// Auth check
onAuthStateChanged(auth, async user=>{
  if(!user){ location.href='auth.html'; return; }
  const userInfo = $('#userInfo');
  userInfo.textContent = `${user.email}`;
  $('#prEmail').textContent=user.email;

  // ambil role dari Firestore
  const u=await getDoc(doc(db,'users',user.uid));
  const role=u.exists()?u.data().role:'anggota';
  $('#prRole').textContent=role;

  userInfo.innerHTML = `${user.email} · <span class="badge">${role}</span>`;
});

$('#logoutBtn').onclick=()=>signOut(auth).then(()=>location.href='index.html');

// Grafik dummy (contoh)
const ctx = document.getElementById('kasChart');
new Chart(ctx, {
  type:'bar',
  data:{
    labels:['Kas Masuk','Kas Keluar'],
    datasets:[{data:[12,5],backgroundColor:['#f6c445','#d94646']}]
  },
  options:{plugins:{legend:{display:false}}}
});
</script>
</body>
</html>
