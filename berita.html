<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title id="titleTag">Berita ‚Ä¢ KARTEJI</title>
<meta name="description" id="metaDesc" content="Berita terbaru Karang Taruna Cilosari Barat">
<meta property="og:title" id="ogTitle" content="Berita KARTEJI">
<meta property="og:description" id="ogDesc" content="Portal Karang Taruna Cilosari Barat">
<meta property="og:image" id="ogImage" content="assets/logo.svg">
<link rel="icon" href="assets/logo.svg" />

<style>
:root{
  --glass-bg:rgba(255,255,255,0.55);
  --text:#111827;--muted:#555;
  --accent:#0e4c92;--highlight:#f6c445;
  --line:rgba(0,0,0,.1);--shadow:0 6px 24px rgba(0,0,0,.15);
}
@media(prefers-color-scheme:dark){
  :root{
    --glass-bg:rgba(25,25,35,0.45);
    --text:#f1f5f9;--muted:#a8b1c0;
    --line:rgba(255,255,255,.15);--shadow:0 10px 40px rgba(0,0,0,.5);
  }
}
*{box-sizing:border-box;transition:.25s ease all}
body{
  margin:0;font-family:'Poppins',system-ui;
  background:url('assets/bg/blur-home.jpg') center/cover fixed no-repeat;
  color:var(--text);min-height:100vh;
}
a{text-decoration:none;color:inherit}
header{
  backdrop-filter:blur(18px);background:var(--glass-bg);
  border-bottom:1px solid var(--line);
  display:flex;justify-content:space-between;align-items:center;
  padding:.9rem 1.2rem;position:sticky;top:0;z-index:10;
  box-shadow:var(--shadow);
}
header b{color:var(--accent)}
header button{
  background:transparent;border:none;color:var(--text);
  cursor:pointer;font-size:1.1rem;margin-right:.6rem;
}
header a{
  background:var(--accent);color:#fff;padding:.45rem .9rem;border-radius:10px;
  font-weight:600;box-shadow:0 4px 12px rgba(14,76,146,.3);
}
.container{
  max-width:840px;margin:auto;padding:1.2rem;
  backdrop-filter:blur(20px);background:var(--glass-bg);
  border:1px solid var(--line);border-radius:20px;box-shadow:var(--shadow);
  margin-top:1.5rem;margin-bottom:2rem;
}
h1{color:var(--accent);margin-bottom:.4rem}
img{max-width:100%;border-radius:12px;margin:.8rem 0;box-shadow:var(--shadow);}
.meta{color:var(--muted);font-size:.9rem;margin-bottom:1rem;}
article{line-height:1.7;font-size:1.05rem}
.comment{border-top:1px solid var(--line);padding-top:.6rem;margin-top:1rem;}
.comment b{color:var(--accent);}
input,textarea{
  width:100%;padding:.6rem;margin-top:.4rem;border-radius:10px;
  border:1px solid var(--line);background:transparent;color:var(--text);
}
button.primary{
  background:var(--highlight);border:none;padding:.55rem 1rem;
  border-radius:10px;font-weight:700;margin-top:.6rem;cursor:pointer;
  color:#0b132b;
}
footer{
  text-align:center;padding:2rem 1rem;color:var(--muted);
}
.nav-nextprev{
  display:flex;justify-content:space-between;gap:1rem;margin-top:2rem;
}
.nav-nextprev a{
  flex:1;text-align:center;padding:.8rem;border-radius:10px;
  backdrop-filter:blur(20px);background:var(--glass-bg);
  border:1px solid var(--line);box-shadow:var(--shadow);
}
.nav-nextprev a:hover{background:var(--highlight);color:#0b132b;}
.hidden{display:none}
</style>
</head>
<body>
<header>
  <b>üì∞ Berita KARTEJI</b>
  <div>
    <button id="themeBtn">üåì</button>
    <a href="index.html">‚Ü©Ô∏è Kembali</a>
  </div>
</header>

<div class="container">
  <h1 id="judul">Memuat...</h1>
  <div id="meta" class="meta"></div>
  <div id="galeri"></div>
  <article id="isi"></article>

  <div id="navContainer" class="nav-nextprev hidden">
    <a id="prevLink">‚¨ÖÔ∏è Berita Sebelumnya</a>
    <a id="nextLink">Berita Selanjutnya ‚û°Ô∏è</a>
  </div>

  <section id="komentarSection" style="margin-top:2rem">
    <h3 style="color:var(--highlight)">üí¨ Komentar</h3>
    <div id="daftarKomentar" class="muted"></div>
    <div id="formKomentar" class="hidden">
      <textarea id="teksKomentar" placeholder="Tulis komentar kamu..." rows="3"></textarea>
      <button id="kirimKomentar" class="primary">Kirim</button>
    </div>
    <p id="loginMsg" class="muted"></p>
  </section>
</div>

<footer>¬© 2025 KARTEJI Cilosari Barat</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
import { getFirestore, doc, getDoc, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyCgJC8OQBG_wQt57tZHfNuVKPb2VVlAalI",
  authDomain: "karang-taruna-aadaf.firebaseapp.com",
  projectId: "karang-taruna-aadaf",
  storageBucket: "karang-taruna-aadaf.appspot.com",
  messagingSenderId: "367208001887",
  appId: "1:367208001887:web:bce5982d99edefb7e746ea"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const params = new URLSearchParams(location.search);
const id = params.get('id');
const $ = s => document.querySelector(s);
$('#themeBtn').onclick = () => document.body.classList.toggle('light');

let beritaList = [];
let currentIndex = -1;
let user = null;

// üîπ Load Semua Berita untuk navigasi
async function loadAllBerita() {
  const snap = await getDocs(query(collection(db, 'berita'), orderBy('createdAt', 'desc')));
  beritaList = snap.docs.map((doc, i) => ({ id: doc.id, ...doc.data(), index: i }));
  currentIndex = beritaList.findIndex(b => b.id === id);
  if (currentIndex === -1) return;
  loadBeritaDetail(beritaList[currentIndex]);
  setupNavigation();
}

// üîπ Tampilkan berita detail
function loadBeritaDetail(b) {
  $('#judul').textContent = b.judul;
  $('#meta').innerHTML = `üìÖ ${(b.createdAt?.toDate ? b.createdAt.toDate() : new Date()).toLocaleDateString('id-ID')} ¬∑ üñãÔ∏è ${b.penulis || 'Anonim'}`;
  $('#isi').innerHTML = (b.isi || '').replace(/\n/g, '<br>');
  const gal = $('#galeri');
  gal.innerHTML = '';
  if (b.foto) {
    (Array.isArray(b.foto) ? b.foto : [b.foto]).forEach(f => {
      const img = document.createElement('img');
      img.src = f;
      gal.appendChild(img);
    });
  }

  // SEO meta update
  $('#titleTag').textContent = `${b.judul} ‚Ä¢ KARTEJI`;
  $('#metaDesc').content = (b.isi || '').slice(0, 150);
  $('#ogTitle').content = b.judul;
  $('#ogDesc').content = (b.isi || '').slice(0, 150);
  $('#ogImage').content = Array.isArray(b.foto) ? b.foto[0] : b.foto || 'assets/logo.svg';
  loadKomentar();
}

// üîπ Navigasi prev / next
function setupNavigation() {
  if (beritaList.length <= 1) return;
  const prev = beritaList[currentIndex + 1];
  const next = beritaList[currentIndex - 1];
  const nav = $('#navContainer');
  nav.classList.remove('hidden');
  if (prev) {
    $('#prevLink').href = `berita.html?id=${prev.id}`;
    $('#prevLink').textContent = `‚¨ÖÔ∏è ${prev.judul.slice(0, 24)}`;
  } else $('#prevLink').classList.add('hidden');
  if (next) {
    $('#nextLink').href = `berita.html?id=${next.id}`;
    $('#nextLink').textContent = `${next.judul.slice(0, 24)} ‚û°Ô∏è`;
  } else $('#nextLink').classList.add('hidden');
}

// üîπ Komentar
onAuthStateChanged(auth, u => {
  user = u;
  if (u) {
    $('#formKomentar').classList.remove('hidden');
    $('#loginMsg').textContent = '';
  } else {
    $('#loginMsg').textContent = 'Masuk untuk berkomentar.';
    $('#formKomentar').classList.add('hidden');
  }
});

async function loadKomentar() {
  const qy = query(collection(db, 'berita', id, 'komentar'), orderBy('createdAt', 'desc'));
  const snap = await getDocs(qy);
  const c = $('#daftarKomentar'); c.innerHTML = '';
  if (snap.empty) {
    c.innerHTML = '<p class="muted">Belum ada komentar.</p>';
    return;
  }
  snap.forEach(d => {
    const k = d.data();
    const div = document.createElement('div');
    div.className = 'comment';
    div.innerHTML = `<b>${k.nama || 'Anonim'}</b><br>${k.teks || ''}`;
    c.appendChild(div);
  });
}

$('#kirimKomentar').onclick = async () => {
  const teks = $('#teksKomentar').value.trim();
  if (!teks || !user) return;
  await addDoc(collection(db, 'berita', id, 'komentar'), {
    nama: user.displayName || user.email || 'Anonim',
    teks,
    createdAt: new Date()
  });
  $('#teksKomentar').value = '';
  await loadKomentar();
  document.querySelector('#daftarKomentar').lastElementChild?.scrollIntoView({ behavior: 'smooth' });
};

// Auto refresh komentar tiap 10 detik
setInterval(loadKomentar, 10000);
loadAllBerita();
</script>
</body>
</html>
