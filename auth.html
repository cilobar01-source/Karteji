<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Masuk ke Portal KARTEJI</title>
<link rel="stylesheet" href="style.css" />
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#0e4c92" />
</head>

<body>
<main class="auth-container">
  <h1>Portal KARTEJI</h1>
  <p>RT01 / RW08 â€¢ Cilosari Barat</p>

  <input type="email" id="email" placeholder="Email" />
  <input type="password" id="pass" placeholder="Kata Sandi" />
  <div class="btn-row">
    <button id="login">Masuk</button>
    <button id="register">Daftar</button>
  </div>
  <button id="reset" class="link-btn">Lupa Password?</button>
  <p id="msg"></p>
</main>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
  import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCgJC8OQBG_wQt57tZHfNuVKPb2VVlAalI",
    authDomain: "karang-taruna-aadaf.firebaseapp.com",
    projectId: "karang-taruna-aadaf",
    storageBucket: "karang-taruna-aadaf.appspot.com",
    messagingSenderId: "367208001887",
    appId: "1:367208001887:web:bce5982d99edefb7e746ea"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const msg = (t) => document.getElementById("msg").innerText = t;

  document.getElementById("login").onclick = async () => {
    const e = email.value, p = pass.value;
    try {
      await signInWithEmailAndPassword(auth, e, p);
      msg("Login berhasil âœ…");
      location.href = "dashboard.html";
    } catch(err) {
      msg("Gagal: " + err.message);
    }
  };

  document.getElementById("register").onclick = async () => {
    const e = email.value, p = pass.value;
    try {
      const res = await createUserWithEmailAndPassword(auth, e, p);
      await setDoc(doc(db, "users", res.user.uid), { email: e, role: "anggota", createdAt: serverTimestamp() });
      msg("Pendaftaran berhasil ðŸŽ‰");
      location.href = "dashboard.html";
    } catch(err) {
      msg("Gagal: " + err.message);
    }
  };

  document.getElementById("reset").onclick = async () => {
    const e = email.value;
    try {
      await sendPasswordResetEmail(auth, e);
      msg("Link reset dikirim ke email ðŸ“§");
    } catch(err) {
      msg("Gagal: " + err.message);
    }
  };
</script>

<script>
if ("serviceWorker" in navigator) navigator.serviceWorker.register("service-worker.js");
</script>
</body>
</html>
