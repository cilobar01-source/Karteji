<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Masuk • KARTEJI v5.6</title>
<link rel="icon" href="assets/logo.svg" />
<meta name="theme-color" content="#0e4c92" />

<style>
:root{
  --glass-bg:rgba(255,255,255,0.55);
  --text:#111827;--muted:#555;
  --accent:#0e4c92;--highlight:#f6c445;
  --line:rgba(0,0,0,.1);--shadow:0 6px 24px rgba(0,0,0,.15);
}
@media(prefers-color-scheme:dark){
  :root{
    --glass-bg:rgba(25,25,35,0.45);
    --text:#f5f7fa;--muted:#a8b1c0;
    --line:rgba(255,255,255,.15);--shadow:0 10px 40px rgba(0,0,0,.5);
  }
}
*{box-sizing:border-box;transition:.25s ease all}
body{
  margin:0;font-family:'Poppins',system-ui;
  background:url('assets/bg/blur-home.jpg') center/cover fixed no-repeat;
  color:var(--text);display:flex;align-items:center;justify-content:center;
  min-height:100vh;padding:1rem;
}

/* === CARD === */
.card{
  width:100%;max-width:420px;padding:1.8rem 1.2rem;
  border-radius:20px;background:var(--glass-bg);backdrop-filter:blur(22px);
  border:1px solid var(--line);box-shadow:var(--shadow);text-align:center;
}
.card img{width:60px;height:60px;margin-bottom:.6rem}
.card h2{margin:.3rem 0 1rem;color:var(--accent)}
input{
  width:100%;padding:.6rem;margin:.4rem 0;
  border-radius:10px;border:1px solid var(--line);
  background:transparent;color:var(--text);font-family:inherit;
}
button{
  width:100%;padding:.65rem;border:none;border-radius:12px;
  font-weight:700;font-size:.95rem;cursor:pointer;margin-top:.6rem;
}
.btn-primary{background:var(--highlight);color:#0b132b}
.btn-ghost{background:transparent;border:1px solid var(--line);color:var(--text)}
p.muted{color:var(--muted);font-size:.9rem;margin-top:1rem}

/* HIDDEN STATE */
.hidden{display:none}
footer{text-align:center;color:var(--muted);margin-top:1rem;font-size:.85rem}
</style>
</head>
<body>

<div class="card">
  <img src="assets/logo.svg" alt="logo" />
  <h2 id="formTitle">Masuk ke KARTEJI</h2>

  <!-- === LOGIN === -->
  <div id="loginForm">
    <input id="loginEmail" type="email" placeholder="Email" />
    <input id="loginPass" type="password" placeholder="Kata sandi" />
    <button class="btn-primary" id="btnLogin">Masuk</button>
    <button class="btn-ghost" id="toRegister">Daftar Akun</button>
    <button class="btn-ghost" id="toForgot">Lupa Password?</button>
  </div>

  <!-- === REGISTER === -->
  <div id="registerForm" class="hidden">
    <input id="regNama" type="text" placeholder="Nama Lengkap" />
    <input id="regEmail" type="email" placeholder="Email" />
    <input id="regPass" type="password" placeholder="Kata sandi (min 6 karakter)" />
    <button class="btn-primary" id="btnRegister">Daftar</button>
    <button class="btn-ghost" id="toLogin1">Sudah punya akun? Masuk</button>
  </div>

  <!-- === FORGOT === -->
  <div id="forgotForm" class="hidden">
    <input id="forgotEmail" type="email" placeholder="Masukkan email untuk reset password" />
    <button class="btn-primary" id="btnForgot">Kirim Tautan Reset</button>
    <button class="btn-ghost" id="toLogin2">Kembali ke Login</button>
  </div>

  <p id="msg" class="muted"></p>
</div>

<footer>© 2025 KARTEJI Portal • Semarang</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, sendPasswordResetEmail, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCgJC8OQBG_wQt57tZHfNuVKPb2VVlAalI",
  authDomain: "karang-taruna-aadaf.firebaseapp.com",
  projectId: "karang-taruna-aadaf",
  storageBucket: "karang-taruna-aadaf.appspot.com",
  messagingSenderId: "367208001887",
  appId: "1:367208001887:web:bce5982d99edefb7e746ea"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const loginForm = document.getElementById("loginForm");
const registerForm = document.getElementById("registerForm");
const forgotForm = document.getElementById("forgotForm");
const msg = document.getElementById("msg");
const formTitle = document.getElementById("formTitle");

// 🔄 Navigasi antar form
document.getElementById("toRegister").onclick = ()=>switchForm("register");
document.getElementById("toForgot").onclick = ()=>switchForm("forgot");
document.getElementById("toLogin1").onclick = ()=>switchForm("login");
document.getElementById("toLogin2").onclick = ()=>switchForm("login");

function switchForm(type){
  loginForm.classList.add("hidden");
  registerForm.classList.add("hidden");
  forgotForm.classList.add("hidden");
  msg.textContent="";
  if(type==="login"){loginForm.classList.remove("hidden");formTitle.textContent="Masuk ke KARTEJI";}
  if(type==="register"){registerForm.classList.remove("hidden");formTitle.textContent="Daftar Akun Baru";}
  if(type==="forgot"){forgotForm.classList.remove("hidden");formTitle.textContent="Lupa Kata Sandi";}
}

// 🔑 Login
document.getElementById("btnLogin").onclick=async()=>{
  const email=document.getElementById("loginEmail").value.trim();
  const pass=document.getElementById("loginPass").value;
  msg.textContent="Memproses...";
  try{
    await signInWithEmailAndPassword(auth,email,pass);
    location.href="dashboard.html";
  }catch(e){msg.textContent=e.message;}
};

// 🆕 Register
document.getElementById("btnRegister").onclick=async()=>{
  const nama=document.getElementById("regNama").value.trim();
  const email=document.getElementById("regEmail").value.trim();
  const pass=document.getElementById("regPass").value;
  msg.textContent="Mendaftarkan akun...";
  try{
    const cred=await createUserWithEmailAndPassword(auth,email,pass);
    await setDoc(doc(db,"users",cred.user.uid),{
      nama,email,role:"Anggota",poin:0,kegiatan:0,iuran:0,createdAt:new Date()
    });
    msg.textContent="Berhasil! Mengalihkan...";
    setTimeout(()=>location.href="dashboard.html",1200);
  }catch(e){msg.textContent=e.message;}
};

// 🔁 Forgot Password
document.getElementById("btnForgot").onclick=async()=>{
  const email=document.getElementById("forgotEmail").value.trim();
  if(!email){msg.textContent="Masukkan email Anda.";return;}
  try{
    await sendPasswordResetEmail(auth,email);
    msg.textContent="Tautan reset telah dikirim ke email.";
  }catch(e){msg.textContent=e.message;}
};

// 🔐 Auto redirect jika sudah login
onAuthStateChanged(auth,(u)=>{if(u)location.href="dashboard.html";});
</script>
</body>
</html>
